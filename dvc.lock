schema: '2.0'
stages:
  preprocess:
    cmd: python src/stages/preprocessing.py --config=params.yaml
    deps:
    - path: src/stages/preprocessing.py
      hash: md5
      md5: 2d91397f8c9a4c72dc46bb3ae860296b
      size: 1297
    params:
      params.yaml:
        base:
          random_state: 42
          log_level: INFO
        data.data_load: data/raw/Customer_Data.csv
    outs:
    - path: data/processed/processed_data.csv
      hash: md5
      md5: 8aff64ed9940f4339131242b798291d5
      size: 786359
  featurize:
    cmd: python src/stages/featurizing.py --config=params.yaml
    deps:
    - path: data/processed/processed_data.csv
      hash: md5
      md5: 8aff64ed9940f4339131242b798291d5
      size: 786359
    - path: src/stages/featurizing.py
      hash: md5
      md5: d14d1d23115e35367ca35bf80006c878
      size: 4276
    params:
      params.yaml:
        data.data_preprocessing: data/processed/processed_data.csv
        featurize:
          featurizer_name: autoencoder
          featurizer_path: models/featurizer.h5
          parameters:
            encoding_dim: 10
          hyperparameters:
            encoder_activation: tanh
            decoder_activation: relu
            optimizer: adam
            loss: mean_squared_error
            epochs: 100
            batch_size: 16
    outs:
    - path: data/processed/featurized_data.csv
      hash: md5
      md5: fa552ea7a911e472a08ff051e6d8da3a
      size: 835117
    - path: models/featurizer.h5
      hash: md5
      md5: dfc6be29066d0d32175be7b05de1fd42
      size: 31136
  train:
    cmd: python src/stages/training.py --config=params.yaml
    deps:
    - path: data/processed/featurized_data.csv
      hash: md5
      md5: fa552ea7a911e472a08ff051e6d8da3a
      size: 835117
    - path: src/stages/training.py
      hash: md5
      md5: c4775ef76fedeadc6b1152cb5506ecdc
      size: 1597
    - path: src/utils/train_util.py
      hash: md5
      md5: e36d8c2a040e865e9f1f08d196dacba4
      size: 2347
    params:
      params.yaml:
        base:
          random_state: 42
          log_level: INFO
        train:
          model_path: models/model.pkl
          model:
            model_name: hdbscan
            param_grid:
              min_cluster_size:
              - 5
              - 10
              min_samples:
              - 5
              - 10
              cluster_selection_epsilon:
              - 0.3
              - 0.5
    outs:
    - path: data/processed/labeled_data.csv
      hash: md5
      md5: 266eba7727da5cf01355e786e3086014
      size: 853195
    - path: models/model.pkl
      hash: md5
      md5: 118a6082913da4456890e7c42ee3ecfd
      size: 1178765
    - path: reports/metrics.json
      hash: md5
      md5: a640c85508521817d6fc6f8dc058c168
      size: 43
  visualize:
    cmd: python src/stages/visualization.py --config=params.yaml
    deps:
    - path: data/processed/labeled_data.csv
      hash: md5
      md5: 266eba7727da5cf01355e786e3086014
      size: 853195
    - path: data/processed/processed_data.csv
      hash: md5
      md5: 8aff64ed9940f4339131242b798291d5
      size: 786359
    - path: src/stages/visualization.py
      hash: md5
      md5: 6d0ce271e36a7611d0fed15eb12a3cf1
      size: 4026
    params:
      params.yaml:
        reports:
          base_dir: reports
          plots_dir: figures
          metrics_file: metrics.json
          plots:
            silhouette: silhouette_plot.png
            elbow: elbow_plot.png
            clusters: clusters.png
            comparison: comparison.png
            frequency: frequency.png
    outs:
    - path: reports/figures/clusters.png
      hash: md5
      md5: ecd2bb93d33d040ccce039fd88c2756d
      size: 187729
    - path: reports/figures/comparison.png
      hash: md5
      md5: a17df530f89cee3c284eb4a53b429820
      size: 107956
    - path: reports/figures/frequency.png
      hash: md5
      md5: a624451b8ab195c255c24e9fb397d499
      size: 21255
