schema: '2.0'
stages:
  preprocess:
    cmd: python src/stages/preprocessing.py --config=params.yaml
    deps:
    - path: src/stages/preprocessing.py
      hash: md5
      md5: 2d91397f8c9a4c72dc46bb3ae860296b
      size: 1297
    params:
      params.yaml:
        base:
          random_state: 42
          log_level: INFO
        data.data_load: data/raw/Customer_Data.csv
    outs:
    - path: data/processed/processed_data.csv
      hash: md5
      md5: 8aff64ed9940f4339131242b798291d5
      size: 786359
  featurize:
    cmd: python src/stages/featurizing.py --config=params.yaml
    deps:
    - path: data/processed/processed_data.csv
      hash: md5
      md5: 8aff64ed9940f4339131242b798291d5
      size: 786359
    - path: src/stages/featurizing.py
      hash: md5
      md5: 5d6796e789e312336072c8f0406a02b4
      size: 4125
    params:
      params.yaml:
        data.data_preprocessing: data/processed/processed_data.csv
        featurize:
          featurizer_name: autoencoder
          featurizer_path: models/featurizer.h5
          parameters:
            encoding_dim: 10
          hyperparameters:
            encoder_activation: tanh
            decoder_activation: relu
            optimizer: adam
            loss: mean_squared_error
            epochs: 100
            batch_size: 16
            validation_split: 0.2
    outs:
    - path: data/processed/featurized_data.csv
      hash: md5
      md5: 4420c3fd988f5eea944eabf40162268c
      size: 839918
    - path: models/featurizer.h5
      hash: md5
      md5: 1f5a2e89ea75cb6ddd19b317e16fe5d9
      size: 31136
  train:
    cmd: python src/stages/training.py --config=params.yaml
    deps:
    - path: data/processed/featurized_data.csv
      hash: md5
      md5: 4420c3fd988f5eea944eabf40162268c
      size: 839918
    - path: src/stages/training.py
      hash: md5
      md5: 8be1be4616d1b3bff321eae8106615e6
      size: 2057
    - path: src/utils/train_util.py
      hash: md5
      md5: 33e71c456f447efaae652f74fc1b7ccf
      size: 2198
    params:
      params.yaml:
        base:
          random_state: 42
          log_level: INFO
        train:
          model_path: models/model.pkl
          model:
            model_name: hdbscan
            param_grid:
              min_cluster_size:
              - 5
              - 10
              min_samples:
              - 5
              - 10
              cluster_selection_epsilon:
              - 0.3
              - 0.5
    outs:
    - path: models/model.pkl
      hash: md5
      md5: 979d39ee3345c120b38f3d03e88c3486
      size: 1181645
    - path: reports/figures/clusters.png
      hash: md5
      md5: a53ea3c9954efafc1661beae9124cf95
      size: 225506
    - path: reports/metrics.json
      hash: md5
      md5: 1af1622a2d7c2e658545468507235b0b
      size: 42
  visualize:
    cmd: python src/stages/visualizing.py --config=params.yaml
    deps:
    - path: data/processed/processed_data.csv
      hash: md5
      md5: 8aff64ed9940f4339131242b798291d5
      size: 786359
    - path: models/featurizer.pkl
      hash: md5
      md5: 84820e6ebd2814e8bd2b4f28f7107479
      size: 2029
    - path: models/model.pkl
      hash: md5
      md5: ed0d857ea862a72b1ab312b83fa1fcbd
      size: 30288
    - path: src/stages/visualizing.py
      hash: md5
      md5: c6400af1746f690e0b813a8c91881050
      size: 1546
    - path: src/utils/visualize_util.py
      hash: md5
      md5: 4f34ab90ff70386ed43addb820aab79a
      size: 2414
    params:
      params.yaml:
        base:
          random_state: 42
          log_level: INFO
        data_preprocessing:
          dataset_processed: data/processed/processed_data.csv
        reports:
          reports_dir: reports
          plots_dir: reports/figures
          metrics_file: metrics.json
          silhouette_plot: silhouette_plot.png
          elbow_plot: elbow_plot.png
    outs:
    - path: reports/figures/clusters.png
      hash: md5
      md5: fb694a36fb1c4d9eae05af826502ca30
      size: 53334
